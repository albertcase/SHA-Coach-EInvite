<!DOCTYPE HTML>
<html>
<head>
	<title>Coach</title>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge, chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="format-detection" content="telephone=no">
	<!--自适应设备宽度-->
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<!--控制全屏时顶部状态栏的外，默认白色-->
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="Keywords" content="">
	<meta name="Description" content="...">

	<link rel="stylesheet" type="text/css" href="./vfile/css/reset.css" />
	<link rel="stylesheet" type="text/css" href="./vfile/pc/css/style.css" />
</head>
<body>

<script src="./vfile/js/jquery.js"></script>
<script src="./vfile/js/PxLoader.js"></script>
<script src="./vfile/js/public.js"></script>


<div class="loading">
	<div class="loading_con">
		<img src="./vfile/img/logo.png" class="car">

		<div class="spinner">
			<div class="bounce1"></div>
			<div class="bounce2"></div>
			<div class="bounce3"></div>
		</div>
		<p>目前涌入的小伙伴过多<br>页面正在跳转中，请耐心等待。</p>
	</div>
</div>

<div class="dreambox ycenter">
	<div class="container ycenter">
		
		<div class="pagecon">
			<a href="javascript:;" class="logo">
				<img src="./vfile/pc/img/logo.png" >
			</a>
			<div class="slogan">
				<img src="./vfile/pc/img/slogan.png" >
			</div>
			<div class="slidecon">
	
				<div class="slideModel checkin">
					<p>
						尊敬的<span class="uname">XXX</span>欢迎您出席<span class="ntime">13: 30</span>的活动
					</p>
					<p>
						SA:<span class="nsa">XXX</span>
					</p>

					<ul class="checklist">
						<li>13: 30活动签到</li>
						<li>15: 30活动签到</li>
						<li>晚宴签到</li>
					</ul>
				</div>

				<div class="slideModel errorTips">无法识别该二维码</div>
				<div class="inputArea">
					<input type="text" id="identifier">
				</div>
				<p class="inputTips">请扫描二维码进行识别</p>

			</div>
			
		</div>
		
	</div>
</div>



<script type="text/javascript">
	
	var eventMethod = {
		scanStatus: false,
		ntArr: ["13：30", "15：30"], 
		visibleFun: function(n){
			$(".slideModel").css({"visibility": "hidden"});
			$(n).css({"visibility": "visible"});
		},
		identifierIsPass: function(n){
			if(n == ""){
				return false;
			}else{
				return true;
			}
		},
		conRewrite: function(n){
			//console.log(n);
			$(".uname").html(n['uname']);
			$(".usa").html(n['usa']);

			if(n['ci1']){
				$(".checklist li").eq(0).addClass("active");
			}

			if(n['ci2']){
				$(".checklist li").eq(1).addClass("active");
			}

			if(n['ci3']){
				$(".checklist li").eq(2).addClass("active");
			}

			$(".ntime").html(ntArr[n['nt']]);

			$(".checklist").attr("data-code", n['tel'])

			//this.scanStatus = true;

			this.visibleFun(".checkin");
		}
	}

	var LoadingImg = [
        "/vfile/pc/img/bg.jpg",
         "/vfile/pc/img/slogan.png",
        "/vfile/pc/img/logo.png"
    ];

    pfun.loadingFnDoing(LoadingImg, function(){
    	$(".loading").css({"visibility": "hidden"});
    })


    $(window).resize( function(){
    	var domw = parseInt($(document).width(), 10),
    		domh = parseInt($(document).height(), 10)
	    if(domw < 1200){
	    	$("body").addClass('heightbg100');
	    }else{
	    	$("body").removeClass('heightbg100');
	    }
	});


	$(document).keypress(function (e) {
		//console.log(e.keyCode); //32空格  13回车
		var identifier = $("#identifier").val(),
			guestinfoPushData = {
				awardcode: identifier
			};
        if (e.keyCode == 13 || e.keyCode == 32){
        	//if(eventMethod.scanStatus) return false;

        	console.log(identifier);

        	

        	if(eventMethod.identifierIsPass(identifier)){
        		pfun.ajaxFun("post", "./api/guestinfo", guestinfoPushData, "json", guestinfoCallback);
        		//eventMethod.visibleFun(".checkin");
        	}else{
        		eventMethod.visibleFun(".errorTips");
        	}
        	
        }
     })

    function guestinfoCallback(data){
        if(data.code == 10){
        	var databox = {
        		'uname': data.memname, 
        		'usa': data.guide, 
        		'ci0': data.meet1status, 
        		'ci1': data.meet2status, 
        		'ci2': data.dinnerstatus, 
        		'nt': data.meettime,
        		'tel': data.callnumber
        	}
        	eventMethod.conRewrite(databox);

        }else if(data.code == 9){
        	eventMethod.visibleFun(".errorTips");
        }else{
        	pfun.formErrorTips(data.msg);
        }
    } 

  

    

    $(".checklist").delegate("li", "click", function(){
    	var self = $(this),
	    	lmPushData = {
		    	awardcode: $(".nsa").html()
		    },
		    _index = self.index(),
		    ajaxSrcArr = ["./api/loginmeets1", "./api/loginmeets2", "./api/logindinner"];
    	
    	if(self.hasClass("disable")) return false;

    	self.addClass("disable");

    	pfun.ajaxFun("post", ajaxSrcArr[_index], lmPushData, "json", lmCallback);

    	function lmCallback(data){

    		if(data.code == 10){
    			if(self.hasClass('active')){
		    		self.removeClass('active');
		    	}else{
		    		self.addClass('active')
		    	}
    		}else{
    			pfun.formErrorTips(data.msg);
    		}

    		self.removeClass("disable");

    	}

    	
    })


</script>



</body>
</html>
